<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title data-i18n="ctaQuote">Get a Quote</title>

  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>

<body>
<header>
  <div class="container nav">
    <div class="brand">
      <div class="logo">VIP</div>
      <div>
        <strong data-i18n="brand"></strong><br>
        <span class="small">Prague â€¢ 24/7</span>
      </div>
    </div>

    <nav class="links">
      <a data-page="home" href="index.html" data-nav="home">Home</a>
      <a data-page="services" href="services.html" data-nav="services">Services</a>
      <a data-page="fleet" href="fleet.html" data-nav="fleet">Fleet</a>
      <a data-page="programs" href="programs.html" data-nav="programs">Programs</a>
      <a data-page="quote" href="quote.html" data-nav="quote">Get a Quote</a>
      <a data-page="contact" href="contact.html" data-nav="contact">Contact</a>
    </nav>

    <div class="lang" aria-label="Language switch">
      <button type="button" data-lang="en">EN</button>
      <button type="button" data-lang="cz">CZ</button>
      <button type="button" data-lang="ar">AR</button>
    </div>
  </div>
</header>

<main class="container" style="padding:26px 0 44px">
  <h1 class="sectionTitle" data-i18n="ctaQuote">Get a Quote</h1>

  <div class="card">
    <form class="form" method="POST" action="https://formsubmit.co/info@vipct.org">
      <input type="hidden" name="_subject" value="VIPCT Quote Request">
      <input type="hidden" name="_captcha" value="true">

      <!-- Trip type -->
      <div class="field">
        <label data-i18n="qTripType">Trip Type</label>
        <select name="trip_type" id="trip_type" required>
          <option value="oneway" data-i18n="qOneWay">One-way</option>
          <option value="roundtrip" data-i18n="qRoundTrip">Round trip</option>
        </select>
      </div>

      <!-- Pickup date/time -->
      <div class="field">
        <label data-i18n="qPickupDate">Pickup Date</label>
        <input name="pickup_date" id="pickup_date" type="date" required>
      </div>

      <div class="field">
        <label data-i18n="qPickupTime">Pickup Time</label>
        <select name="pickup_time" id="pickup_time" required></select>
      </div>

      <!-- Return fields (only for round trip) -->
      <div id="return_fields" style="display:none;">
        <div class="field">
          <label data-i18n="qReturnDate">Return Date</label>
          <input name="return_date" id="return_date" type="date" disabled>
        </div>

        <div class="field">
          <label data-i18n="qReturnTime">Return Time</label>
          <select name="return_time" id="return_time" disabled></select>
        </div>
      </div>

      <div class="field">
        <label data-i18n="qPickupLocation">Pickup location</label>
        <input name="pickup" type="text" id="pickup" data-i18n-placeholder="qPlaceholderPickup" placeholder="Airport / hotel / address" required>
      </div>

      <div class="field">
        <label data-i18n="qDropoffLocation">Drop-off location</label>
        <input name="dropoff" type="text" id="dropoff" data-i18n-placeholder="qPlaceholderDropoff" placeholder="City / address" required>
      </div>

      <div class="field">
        <label data-i18n="qPassengers">Passengers</label>
        <input name="passengers" id="passengers" type="number" min="1" max="60" required>
      </div>

      <div class="field">
        <label data-i18n="qLuggage">Luggage</label>
        <input name="luggage" id="luggage" type="text" data-i18n-placeholder="qPlaceholderLuggage" placeholder="e.g. 4 suitcases + 2 backpacks">
      </div>

      <div class="field">
        <label data-i18n="qVehicle">Vehicle preference</label>
        <select name="vehicle" id="vehicle" required>
          <option value="Sedan" data-i18n="qVehicleSedan">Sedan</option>
          <option value="Mercedes V-Class / Vito" data-i18n="qVehicleVClass">Mercedes V-Class / Vito</option>
          <option value="Minibus 8-20" data-i18n="qVehicleCoach">Minibus 8-20</option>
          <option value="Coach +21" data-i18n="qVehicleCoach">Coach +21</option>
        </select>
      </div>

      <div class="field">
        <label data-i18n="qName">Name</label>
        <input name="name" id="name" type="text" required>
      </div>

      <div class="field">
        <label data-i18n="qPhone">Phone</label>
        <input name="phone" type="tel" id="phone" placeholder="+420 775 091 730" required>
      </div>

      <div class="field">
        <label data-i18n="qEmail">Email</label>
        <input name="email" id="email" type="email" required>
      </div>

      <div class="field">
        <label data-i18n="qNotes">Notes</label>
        <textarea name="notes" id="notes" data-i18n-placeholder="qPlaceholderNotes" placeholder="Flight number, stops, child seats..."></textarea>
      </div>

      <div class="heroActions">
        <button class="btn primary" type="submit" data-i18n="qSend">Send Request</button>
        <button type="button" class="btn" id="whatsappBtn" disabled>WhatsApp</button>
      </div>

      <p class="note" data-i18n="qFormSubmitNote">
        After first submit, FormSubmit will email you a confirmation link to activate. Open that email and click confirm.
      </p>
    </form>
  </div>
</main>

<div class="whatsapp-float">
  <a data-wa href="#">WhatsApp â€¢ +420 775 091 730</a>
</div>

<footer class="footer">
  <div class="container">
    <div class="small" data-i18n="footerNote"></div>
  </div>
</footer>

<!-- WhatsApp Confirm Modal -->
<div id="waModalOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); backdrop-filter:blur(6px); z-index:9999;">
  <div id="waModal" style="max-width:520px; margin:8vh auto; background:#121212; border:1px solid rgba(255,255,255,.12); border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.55); overflow:hidden;">
    <div style="display:flex; align-items:center; gap:12px; padding:16px 16px; border-bottom:1px solid rgba(255,255,255,.10);">
      <div style="width:44px; height:44px; border-radius:12px; background:rgba(255,255,255,.06); display:grid; place-items:center; border:1px solid rgba(255,255,255,.10); overflow:hidden;">
        <img src="assets/logo-gold.png" alt="VIP Coach Transfers" style="max-height:28px; width:auto;">
      </div>
      <div style="line-height:1.2">
        <div style="font-weight:800;" data-i18n="waModalTitle">VIP Coach Transfers</div>
        <div style="color:#cfcfcf; font-size:13px;" data-i18n="waModalSubtitle">Confirm WhatsApp booking</div>
      </div>
      <button id="waClose" type="button" style="margin-left:auto; background:transparent; border:0; color:#cfcfcf; font-size:18px; cursor:pointer;">âœ•</button>
    </div>

    <div style="padding:16px;">
      <div style="color:#cfcfcf; font-size:13px; margin-bottom:10px;" data-i18n="waPreviewLabel">Message preview:</div>
      <pre id="waPreview" style="margin:0; white-space:pre-wrap; background:#0f0f0f; border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:12px; color:#fff; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size:12px; line-height:1.35;"></pre>

      <div id="waLoading" style="display:none; margin-top:14px; color:#cfcfcf; font-size:13px; align-items:center; gap:10px;">
        <span style="display:inline-block; width:18px; height:18px; border:2px solid rgba(255,255,255,.25); border-top-color:#caa54c; border-radius:50%; animation:spin .8s linear infinite;"></span>
        <span data-i18n="waOpening">Opening WhatsAppâ€¦</span>
      </div>

      <div style="display:flex; gap:10px; margin-top:16px; flex-wrap:wrap;">
        <button id="waCancel" type="button" class="btn" style="flex:1;" data-i18n="waCancel">Cancel</button>
        <button id="waSend" type="button" class="btn primary" style="flex:1;" data-i18n="waSend">Send via WhatsApp</button>
      </div>

      <div style="margin-top:10px; color:#cfcfcf; font-size:12px;" data-i18n="waRedirectNote">
        You will be redirected to the confirmation page after WhatsApp opens.
      </div>
    </div>
  </div>
</div>

<style>
  @keyframes spin { to { transform: rotate(360deg); } }
</style>

<script src="assets/data.js"></script>
<script src="assets/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
  const whatsappBtn = document.getElementById("whatsappBtn");

  const overlay = document.getElementById("waModalOverlay");
  const waPreview = document.getElementById("waPreview");
  const waClose = document.getElementById("waClose");
  const waCancel = document.getElementById("waCancel");
  const waSend = document.getElementById("waSend");
  const waLoading = document.getElementById("waLoading");

  function pad2(n){ return String(n).padStart(2,'0'); }

  function fillTimeSelect(selectEl){
    selectEl.innerHTML = "";
    for(let h=0; h<24; h++){
      for(let m=0; m<60; m+=5){
        const t = `${pad2(h)}:${pad2(m)}`;
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        selectEl.appendChild(opt);
      }
    }
  }

  function setMinToday(inputEl){
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = pad2(now.getMonth()+1);
    const dd = pad2(now.getDate());
    inputEl.min = `${yyyy}-${mm}-${dd}`;
  }

  function updateReturnFields(){
    const tripType = document.getElementById("trip_type").value;
    const wrap = document.getElementById("return_fields");
    const rDate = document.getElementById("return_date");
    const rTime = document.getElementById("return_time");
    const isRound = tripType === "roundtrip";
    wrap.style.display = isRound ? "block" : "none";
    rDate.required = isRound; rTime.required = isRound;
    rDate.disabled = !isRound; rTime.disabled = !isRound;
  }

  function syncReturnMin(){
    const pDate = document.getElementById("pickup_date").value;
    const rDate = document.getElementById("return_date");
    if(pDate){
      rDate.min = pDate;
      if(rDate.value && rDate.value < pDate) rDate.value = "";
    }
  }

  function checkRequiredFields() {
    const pickup = document.getElementById("pickup").value.trim();
    const dropoff = document.getElementById("dropoff").value.trim();
    const passengers = document.getElementById("passengers").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const pickupDate = document.getElementById("pickup_date").value;
    const pickupTime = document.getElementById("pickup_time").value;
    const tripType = document.getElementById("trip_type").value;

    let valid = Boolean(pickup && dropoff && passengers && phone && pickupDate && pickupTime && tripType);

    if (tripType === "roundtrip") {
      const rDate = document.getElementById("return_date").value;
      const rTime = document.getElementById("return_time").value;
      if (!rDate || !rTime) valid = false;
    }

    whatsappBtn.disabled = !valid;
  }

  document.querySelectorAll("input, select, textarea").forEach(el => {
    el.addEventListener("input", checkRequiredFields);
    el.addEventListener("change", checkRequiredFields);
  });

  function openModal(){
    overlay.style.display = "block";
    waLoading.style.display = "none";
    waSend.disabled = false;
  }
  function closeModal(){ overlay.style.display = "none"; }

  waClose.addEventListener("click", closeModal);
  waCancel.addEventListener("click", closeModal);
  overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });

  async function detectCountry(){
    try{
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "";
      const lang = navigator.language || "";
      const res = await fetch("https://ipapi.co/json/");
      if(!res.ok) throw new Error("geo failed");
      const json = await res.json();
      return { country: json.country_name || "", countryCode: json.country || "", city: json.city || "", tz, lang };
    }catch(e){
      return { country:"", countryCode:"", city:"", tz:(Intl.DateTimeFormat().resolvedOptions().timeZone||""), lang:(navigator.language||"") };
    }
  }

  function buildMessage(lang, geo){
    const date = document.getElementById("pickup_date").value;
    const time = document.getElementById("pickup_time").value;
    const pickup = document.getElementById("pickup").value;
    const dropoff = document.getElementById("dropoff").value;
    const passengers = document.getElementById("passengers").value;
    const luggage = document.getElementById("luggage").value || "-";
    const vehicle = document.getElementById("vehicle").value;
    const phone = document.getElementById("phone").value;
    const tripType = document.getElementById("trip_type").value;

    const countryLine = geo.country
      ? `${geo.city ? geo.city + ", " : ""}${geo.country}${geo.countryCode ? " (" + geo.countryCode + ")" : ""}`
      : (geo.tz || geo.lang ? `${geo.tz}${geo.lang ? " â€¢ " + geo.lang : ""}` : "");

    if(lang === "ar"){
      let msg =
`Ø·Ù„Ø¨ Ø­Ø¬Ø² - VIP Coach Transfers

ðŸš— Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©: ${tripType === "roundtrip" ? "Ø°Ù‡Ø§Ø¨ ÙˆØ¹ÙˆØ¯Ø©" : "Ø°Ù‡Ø§Ø¨ ÙÙ‚Ø·"}

ðŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚: ${date}
â° ÙˆÙ‚Øª Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚: ${time}

ðŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚: ${pickup}
ðŸ“ Ø§Ù„ÙˆØ¬Ù‡Ø©: ${dropoff}

ðŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨: ${passengers}
ðŸ§³ Ø§Ù„Ø£Ù…ØªØ¹Ø©: ${luggage}
ðŸš˜ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${vehicle}

ðŸ“ž Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ${phone}`;

      if (countryLine) msg += `

ðŸŒ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${countryLine}`;

      if(tripType === "roundtrip"){
        const rDate = document.getElementById("return_date").value;
        const rTime = document.getElementById("return_time").value;
        msg += `

ðŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹ÙˆØ¯Ø©: ${rDate}
â° ÙˆÙ‚Øª Ø§Ù„Ø¹ÙˆØ¯Ø©: ${rTime}`;
      }
      return msg;
    }

    let msg =
`VIP Coach Transfers Booking Request

ðŸš— Trip Type: ${tripType === "roundtrip" ? "Round Trip" : "One Way"}

ðŸ“… Pickup Date: ${date}
â° Pickup Time: ${time}

ðŸ“ Pickup: ${pickup}
ðŸ“ Drop-off: ${dropoff}

ðŸ‘¥ Passengers: ${passengers}
ðŸ§³ Luggage: ${luggage}
ðŸš˜ Vehicle: ${vehicle}

ðŸ“ž Client Phone: ${phone}`;

    if (countryLine) msg += `

ðŸŒ Client Location: ${countryLine}`;

    if(tripType === "roundtrip"){
      const rDate = document.getElementById("return_date").value;
      const rTime = document.getElementById("return_time").value;
      msg += `

ðŸ“… Return Date: ${rDate}
â° Return Time: ${rTime}`;
    }

    return msg;
  }

  let cachedGeo = null;
  let lastMessage = "";

  whatsappBtn.addEventListener("click", async () => {
    const lang = (document.documentElement.lang || "en").startsWith("ar") ? "ar" : "en";
    if(!cachedGeo) cachedGeo = await detectCountry();
    lastMessage = buildMessage(lang, cachedGeo);
    waPreview.textContent = lastMessage;
    openModal();
  });

  waSend.addEventListener("click", () => {
    waSend.disabled = true;
    waLoading.style.display = "flex";

    // Save summary for thankyou page
    const tripType = document.getElementById("trip_type").value;
    const lang = (document.documentElement.lang || "en").startsWith("ar") ? "ar" : "en";

    const booking = {
      trip_type: tripType,
      tripLabel: (lang === "ar")
        ? (tripType === "roundtrip" ? "Ø°Ù‡Ø§Ø¨ ÙˆØ¹ÙˆØ¯Ø©" : "Ø°Ù‡Ø§Ø¨ ÙÙ‚Ø·")
        : (tripType === "roundtrip" ? "Round Trip" : "One Way"),
      pickup_date: document.getElementById("pickup_date").value,
      pickup_time: document.getElementById("pickup_time").value,
      return_date: tripType === "roundtrip" ? (document.getElementById("return_date").value || "") : "",
      return_time: tripType === "roundtrip" ? (document.getElementById("return_time").value || "") : "",
      pickup: document.getElementById("pickup").value,
      dropoff: document.getElementById("dropoff").value,
      passengers: document.getElementById("passengers").value,
      luggage: document.getElementById("luggage").value || "-",
      vehicle: document.getElementById("vehicle").value,
      phone: document.getElementById("phone").value
    };

    sessionStorage.setItem("vipct_booking", JSON.stringify(booking));
    sessionStorage.setItem("vipct_wa_message", lastMessage);

    window.open(`https://wa.me/420775091730?text=${encodeURIComponent(lastMessage)}`, "_blank");

    setTimeout(() => { window.location.href = "thankyou.html"; }, 900);
  });

  document.addEventListener("DOMContentLoaded", () => {
    const tripType = document.getElementById("trip_type");
    const pickupDate = document.getElementById("pickup_date");
    const returnDate = document.getElementById("return_date");
    const pickupTime = document.getElementById("pickup_time");
    const returnTime = document.getElementById("return_time");

    fillTimeSelect(pickupTime);
    fillTimeSelect(returnTime);

    setMinToday(pickupDate);
    setMinToday(returnDate);

    flatpickr("#pickup_date", { minDate: "today", dateFormat: "Y-m-d" });
    flatpickr("#return_date", { minDate: "today", dateFormat: "Y-m-d" });

    tripType.addEventListener("change", () => { updateReturnFields(); checkRequiredFields(); });
    pickupDate.addEventListener("change", () => { syncReturnMin(); checkRequiredFields(); });

    returnDate.addEventListener("change", checkRequiredFields);
    returnTime.addEventListener("change", checkRequiredFields);

    updateReturnFields();
    syncReturnMin();
    checkRequiredFields();
  });
</script>

</body>
</html>
